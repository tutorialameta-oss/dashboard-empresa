<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>LA META — Debug Evaluaciones</title>
  <style>
    body{font-family:system-ui,Segoe UI,Arial,sans-serif;background:#faf7f7;margin:0;padding:24px;}
    .card{max-width:1000px;margin:0 auto;background:#fff;border:1px solid #eee;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.06);padding:18px;}
    h1{margin:0 0 8px 0;font-size:20px;}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:10px 0;}
    input{flex:1;min-width:280px;padding:10px 12px;border:1px solid #ddd;border-radius:10px;}
    button{padding:10px 14px;border:0;border-radius:10px;background:#b91c1c;color:#fff;font-weight:700;cursor:pointer;}
    button.secondary{background:#111827}
    button.gray{background:#6b7280}
    pre{white-space:pre-wrap;background:#0b1220;color:#e5e7eb;border-radius:12px;padding:12px;max-height:520px;overflow:auto;}
    .note{color:#374151;font-size:13px;line-height:1.4}
    .ok{color:#065f46;font-weight:700}
    .bad{color:#b91c1c;font-weight:700}
  </style>
</head>
<body>
  <div class="card">
    <h1>LA META — Debug Evaluaciones (JSONP)</h1>
    <div class="note">
      Esto sirve para confirmar si tu WebApp (/exec) está devolviendo datos. Si aquí funciona, el problema está en el panel GitHub.
    </div>

    <div class="row">
      <input id="url" value="https://script.google.com/macros/s/AKfycbxT0lOvu20Vo8_3leNUxgCrH1hpK2pGx2qo37t6bCRW2VusVDXvBSJni0btkI7mmdXR/exec" />
      <input id="key" value="LAMETA2026" style="max-width:180px"/>
    </div>

    <div class="row">
      <button onclick="callApi('ping')">PING</button>
      <button class="secondary" onclick="callApi('selftest')">SELFTEST</button>
      <button class="gray" onclick="callList()">LIST (AGRARIA / AGRARIA 2)</button>
      <button class="gray" onclick="callListCurso()">LIST (curso: RAZONAMIENTO VERBAL)</button>
      <button class="gray" onclick="clearOut()">LIMPIAR</button>
    </div>

    <div class="row note">
      <div>Esperado en SELFTEST: <span class="ok">evalInfo.ok=true</span> y que exista pestaña <b>EVAL_PDFS</b>.</div>
    </div>

    <pre id="out">Listo. Pulsa PING o SELFTEST.</pre>
  </div>

<script>
function clearOut() {
  document.getElementById('out').textContent = "";
}
function log(obj) {
  const out = document.getElementById('out');
  out.textContent = JSON.stringify(obj, null, 2);
}
function callApi(action, params={}) {
  const url = document.getElementById('url').value.trim();
  const key = document.getElementById('key').value.trim();
  const cb = "cb_" + Math.random().toString(16).slice(2);
  window[cb] = (data) => {
    try { log(data); }
    finally { delete window[cb]; script.remove(); }
  };
  const usp = new URLSearchParams({ apiKey:key, action, callback:cb, ...params });
  const full = url + "?" + usp.toString();
  const script = document.createElement('script');
  script.src = full;
  script.onerror = () => {
    log({ ok:false, error:"jsonp_load_failed", url: full });
    delete window[cb];
  };
  document.body.appendChild(script);
}
function callList() {
  callApi('list', { universidad:'AGRARIA', salon:'AGRARIA 2' });
}
function callListCurso() {
  callApi('list', { universidad:'AGRARIA', salon:'AGRARIA 2', curso:'RAZONAMIENTO VERBAL' });
}
</script>
</body>
</html>
